@echo off
:: ==============================================
:: –õ–æ–∫–∞–ª—å–Ω—ã–π HTTP –°–µ—Ä–≤–µ—Ä - –ü—Ä–æ–µ–∫—Ç 213
:: –í–µ—Ä—Å–∏—è 1.1
:: ==============================================

:: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
set SERVER_SCRIPT=server.py
set PYTHON_URL=https://www.python.org/downloads/
set PORT=8000
set TIMEOUT=5

:: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
chcp 65001 >nul
title –õ–æ–∫–∞–ª—å–Ω—ã–π HTTP –°–µ—Ä–≤–µ—Ä - –ü—Ä–æ–µ–∫—Ç 213
color 0A

:: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
:show_header
echo.
echo ========================================
echo    üöÄ –ó–ê–ü–£–°–ö –õ–û–ö–ê–õ–¨–ù–û–ì–û –°–ï–†–í–ï–†–ê
echo ========================================
echo.
goto :eof

:: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
:show_error
echo ‚ùå –û–®–ò–ë–ö–ê: %*
exit /b 1

:: –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
:check_dependencies
:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python
python --version >nul 2>&1
if %errorlevel% neq 0 (
    call :show_header
    echo ‚ùå Python –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —ç—Ç–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ!
    echo.
    echo üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
    echo 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞: %PYTHON_URL%
    echo 2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∏ Python –≤ PATH –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
    echo 3. –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
    echo.
    pause
    call :show_error "–¢—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Python"
)

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ —Å–µ—Ä–≤–µ—Ä–∞
if not exist "%SERVER_SCRIPT%" (
    call :show_header
    call :show_error "–§–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞ '%SERVER_SCRIPT%' –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏"
)

echo ‚úÖ Python –Ω–∞–π–¥–µ–Ω
echo ‚úÖ –§–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω
goto :eof

:: –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
call :show_header
call :check_dependencies

echo üìÅ –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: %cd%
echo üåê –ó–∞–ø—É—Å–∫–∞—é —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É %PORT%...
echo ‚è≥ –¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: %TIMEOUT% —Å–µ–∫
echo üñ•Ô∏è –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª: %SERVER_SCRIPT%
echo.

:: –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–Ω—è—Ç –ª–∏ –ø–æ—Ä—Ç
netstat -ano | findstr ":%PORT%" >nul
if %errorlevel% == 0 (
    echo ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: –ü–æ—Ä—Ç %PORT% —É–∂–µ –∑–∞–Ω—è—Ç!
    echo.
    choice /c YN /m "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —ç—Ç–æ? (Y/N)"
    if %errorlevel% == 2 (
        exit /b 0
    )
    echo.
)

:: –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π CTRL+C
echo üèÅ –ó–∞–ø—É—Å–∫–∞—é —Å–µ—Ä–≤–µ—Ä... (–¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ CTRL+C)
echo ========================================
echo.

python "%SERVER_SCRIPT%" %PORT%

:: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
if %errorlevel% neq 0 (
    echo.
    echo ‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –∑–∞–≤–µ—Ä—à–∏–ª —Ä–∞–±–æ—Ç—É —Å –æ—à–∏–±–∫–æ–π (–∫–æ–¥: %errorlevel%)
) else (
    echo.
    echo üèÅ –°–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
)

echo.
pause
